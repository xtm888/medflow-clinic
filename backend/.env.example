# =====================================================
# MedFlow Backend Environment Configuration
# =====================================================
# SECURITY WARNING: NEVER commit this file with real values!
# Copy this file to .env and update the values
#
# IMPORTANT: If secrets were ever committed to git, they MUST be rotated!
# Use `git filter-branch` or BFG to remove from history.
# =====================================================

# Server Configuration
NODE_ENV=production
PORT=5001

# Database Configuration
# For local MongoDB:
MONGODB_URI=mongodb://127.0.0.1:27017/medflow
# For MongoDB Atlas (cloud):
# MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/medflow?retryWrites=true&w=majority

# =====================================================
# JWT Configuration (CRITICAL - ROTATE AFTER ANY EXPOSURE)
# =====================================================
# Generate with: openssl rand -hex 32
JWT_SECRET=GENERATE_NEW_SECRET_WITH_OPENSSL_RAND_HEX_32

# Access token expiry (RECOMMENDED: 15m for high-security, 1h for convenience)
# Format: 15m (minutes), 1h (hours), 1d (days)
# Healthcare recommendation: 15m to minimize session hijacking window
JWT_EXPIRE=15m

# Cookie expiry in days (for "remember me" functionality)
JWT_COOKIE_EXPIRE=7

# SECURITY: Separate secret for refresh tokens (MUST be different from JWT_SECRET)
# Generate with: openssl rand -base64 48
REFRESH_TOKEN_SECRET=GENERATE_NEW_SECRET_WITH_OPENSSL_RAND_BASE64_48

# Refresh token expiry (RECOMMENDED: 7d for high-security, 30d for convenience)
# Healthcare recommendation: 14d or less for compliance
REFRESH_TOKEN_EXPIRE=30d

# Session secret (used for express-session)
# Generate with: openssl rand -hex 32
SESSION_SECRET=GENERATE_NEW_SECRET_WITH_OPENSSL_RAND_HEX_32

# =====================================================
# Encryption Keys (CRITICAL - 32 bytes/64 hex chars)
# =====================================================
# Generate with: openssl rand -hex 32
ENCRYPTION_KEY=GENERATE_NEW_KEY_WITH_OPENSSL_RAND_HEX_32
BACKUP_ENCRYPTION_KEY=GENERATE_NEW_KEY_WITH_OPENSSL_RAND_HEX_32
CALENDAR_ENCRYPTION_KEY=GENERATE_NEW_KEY_WITH_OPENSSL_RAND_HEX_32
LIS_ENCRYPTION_KEY=GENERATE_NEW_KEY_WITH_OPENSSL_RAND_HEX_32

# PHI (Protected Health Information) encryption key
# Used for field-level encryption of sensitive medical data (SSN, HIV status, etc.)
# CRITICAL: This key encrypts patient health data at rest
PHI_ENCRYPTION_KEY=GENERATE_NEW_KEY_WITH_OPENSSL_RAND_HEX_32

# PHI Key Rotation Support
# When rotating keys, add the new key here and set PHI_KEY_ID to use it
# The old key (PHI_ENCRYPTION_KEY) remains to decrypt legacy data
# After migration, you can remove PHI_KEY_ID to auto-use highest version
#
# To rotate keys:
# 1. Generate new key: openssl rand -hex 32
# 2. Add as PHI_ENCRYPTION_KEY_V2 (or V3, V4, etc.)
# 3. Set PHI_KEY_ID=key_v2 to encrypt new data with new key
# 4. Run key rotation script to re-encrypt existing data
# 5. After full rotation, old keys can be archived (keep for recovery)
#
# PHI_ENCRYPTION_KEY_V2=GENERATE_NEW_KEY_FOR_ROTATION
# PHI_ENCRYPTION_KEY_V3=GENERATE_NEW_KEY_FOR_NEXT_ROTATION
# PHI_KEY_ID=key_v2

# Health API Key (for health check endpoints)
# Generate with: openssl rand -hex 16
HEALTH_API_KEY=GENERATE_NEW_KEY_WITH_OPENSSL_RAND_HEX_16

# =====================================================
# Frontend & CORS
# =====================================================
FRONTEND_URL=http://localhost:5173

# =====================================================
# Redis (optional - falls back to in-memory if not available)
# =====================================================
REDIS_URL=redis://localhost:6379

# =====================================================
# Email Configuration (for notifications)
# =====================================================
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password

# =====================================================
# File Upload
# =====================================================
MAX_FILE_SIZE=10485760
UPLOAD_PATH=./uploads

# =====================================================
# External Services
# =====================================================
# Face Recognition Service (Python microservice)
FACE_SERVICE_URL=http://127.0.0.1:5002

# OCR Service
OCR_SERVICE_URL=http://127.0.0.1:5003

# Optional: Twilio SMS Configuration
# TWILIO_ACCOUNT_SID=your-twilio-account-sid
# TWILIO_AUTH_TOKEN=your-twilio-auth-token
# TWILIO_PHONE_NUMBER=+1234567890

# Optional: Google Calendar Integration
# GOOGLE_CLIENT_ID=your-google-client-id
# GOOGLE_CLIENT_SECRET=your-google-client-secret

# Optional: API Keys
# GOOGLE_MAPS_API_KEY=your-google-maps-api-key
# OPENAI_API_KEY=your-openai-api-key

# =====================================================
# Multi-Clinic Configuration
# =====================================================
CLINIC_ID=KINSHASA_MAIN

# Cloud sync (leave empty for local-only mode)
# CLOUD_API_URL=https://cloud.medflow.cd/api
# CLOUD_SYNC_TOKEN=your-sync-token-here
SYNC_ENABLED=false
SYNC_INTERVAL_MS=300000

# =====================================================
# Backup Configuration
# =====================================================
BACKUP_ENABLED=true
BACKUP_DIR=/var/backups/medflow
BACKUP_CLOUD_ENABLED=false
BACKUP_CLOUD_PROVIDER=s3

# Admin notifications
ADMIN_EMAIL=admin@medflow.com
ADMIN_PHONE=+243900000000

# =====================================================
# Clinic Configuration (for PDFs and Documents)
# =====================================================
CLINIC_NAME=Centre Ophtalmologique Magloire
CLINIC_ADDRESS=Avenue de la Sant√©, Kinshasa
CLINIC_PHONE=+243 XXX XXX XXX
CLINIC_EMAIL=contact@magloire-ophtalmo.cd
CLINIC_WEBSITE=www.magloire-ophtalmo.cd
CLINIC_CITY=Kinshasa
CLINIC_TAX_ID=NIF: XXXXXXXXXX
BASE_CURRENCY=CDF

# Logo paths
CLINIC_LOGO_PATH=./public/images/clinic-logo.png
OPTICAL_LOGO_PATH=./public/images/optical-logo.png
PHARMACY_LOGO_PATH=./public/images/pharmacy-logo.png

# =====================================================
# Logging
# =====================================================
LOG_LEVEL=info
LOG_PATH=./logs

# =====================================================
# Default Credentials (CHANGE IN PRODUCTION!)
# =====================================================
# Used by seeding scripts only - never use these in production
DEFAULT_ADMIN_PASSWORD=YourSecureAdminPassword123!
DEFAULT_USER_PASSWORD=YourSecureUserPassword123!
